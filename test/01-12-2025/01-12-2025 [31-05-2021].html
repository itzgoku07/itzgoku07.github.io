<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE Advanced CBT Mock</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 1. MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <!-- 2. Load MathJax -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark ::-webkit-scrollbar-track { background: #1e293b; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        :root {
            --status-answered: #10b981;
            --status-not-answered: #ef4444;
            --status-not-visited: #ffffff;
            --status-review: #8b5cf6;
            --status-ans-review: #6366f1;
        }
        .dark { --status-not-visited: #334155; }

        .p-btn { width: 40px; height: 36px; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; cursor: pointer; font-size: 14px; font-weight: 600; border-radius: 6px; transition: all 0.2s ease; position: relative; }
        .dark .p-btn { border-color: #475569; }
        .p-btn:hover { transform: translateY(-1px); }
        .p-btn.active-q { border: 2px solid #3b82f6; ring: 2px solid #93c5fd; transform: scale(1.05); z-index: 10; }

        .st-not-visited { background-color: var(--status-not-visited); color: #334155; }
        .dark .st-not-visited { color: #f1f5f9; }
        .st-not-answered { background-color: var(--status-not-answered); color: white; border-color: #dc2626; clip-path: polygon(0 0, 100% 0, 100% 75%, 50% 100%, 0 75%); }
        .st-answered { background-color: var(--status-answered); color: white; border-color: #059669; clip-path: polygon(50% 0, 100% 25%, 100% 100%, 0 100%, 0 25%); }
        .st-review { background-color: var(--status-review); color: white; border-radius: 50%; }
        .st-ans-review { background-color: var(--status-review); color: white; border-radius: 50%; position: relative; }
        .st-ans-review::after { content: '✓'; position: absolute; bottom: -2px; right: -4px; width: 14px; height: 14px; background-color: var(--status-answered); border-radius: 50%; border: 1px solid white; font-size: 9px; display: flex; align-items: center; justify-content: center; }

        .tab-btn { position: relative; transition: all 0.2s; border-radius: 8px 8px 0 0; background: rgba(255, 255, 255, 0.1); }
        .tab-btn.active { background: white; color: #1e293b; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .dark .tab-btn.active { background: #1e293b; color: #f8fafc; }
        .tab-btn.active::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: #3b82f6; border-radius: 3px 3px 0 0; }

        .custom-radio { appearance: none; width: 20px; height: 20px; border: 2px solid #cbd5e1; border-radius: 50%; margin-right: 12px; margin-top: 2px; position: relative; cursor: pointer; }
        .dark .custom-radio { border-color: #475569; }
        .custom-radio:checked { border-color: #3b82f6; border-width: 6px; }
    </style>
</head>
<body class="h-screen flex flex-col bg-slate-50 dark:bg-slate-900 overflow-hidden text-slate-800 dark:text-slate-200 transition-colors duration-200">

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay" class="fixed inset-0 bg-slate-900 z-[60] flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-blue-600 p-6 text-center">
                <h2 class="text-2xl font-bold text-white tracking-wide">Candidate Login</h2>
                <p class="text-blue-100 text-sm mt-1">JEE (Advanced) Computer Based Test</p>
            </div>
            <form id="login-form" class="p-8 space-y-6">
                <div><label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Registration ID</label><input type="text" id="login-id" class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:border-blue-500 outline-none" required></div>
                <div><label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Password</label><input type="password" id="login-pass" class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:border-blue-500 outline-none" required></div>
                <div id="login-error" class="hidden text-red-500 text-sm font-medium text-center bg-red-50 dark:bg-red-900/20 dark:border-red-800 p-2 rounded border border-red-100">Invalid Credentials</div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg transition-all active:scale-95">Login</button>
            </form>
        </div>
    </div>

    <!-- START OVERLAY -->
    <div id="start-overlay" class="hidden fixed inset-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm z-50 flex flex-col items-center justify-center p-6">
        <div class="bg-white dark:bg-slate-800 max-w-4xl w-full rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700 flex flex-col max-h-[90vh]">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-white text-center"><h1 class="text-3xl font-bold tracking-tight">JEE (Advanced) Mock Test</h1></div>
            <div class="p-8 overflow-y-auto custom-scrollbar flex-1 bg-slate-50 dark:bg-slate-900"><h2 class="font-bold text-lg text-slate-800 dark:text-white mb-4">General Instructions</h2><ol class="list-decimal pl-5 space-y-4 text-sm text-slate-600 dark:text-slate-300"><li>The server clock will be set at the server.</li><li>The Question Palette displayed on the right side of the screen will show the status of each question using one of the following symbols:<div class="grid grid-cols-2 gap-4 mt-3 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700"><div class="flex items-center gap-3"><span class="w-8 h-8 flex items-center justify-center border bg-white dark:bg-slate-700 rounded shadow-sm text-xs font-bold text-slate-400">1</span> Not Visited</div><div class="flex items-center gap-3"><div class="w-8 h-8 flex items-center justify-center border bg-red-500 text-white text-xs font-bold" style="clip-path: polygon(0 0, 100% 0, 100% 75%, 50% 100%, 0 75%);">2</div> Not Answered</div><div class="flex items-center gap-3"><div class="w-8 h-8 flex items-center justify-center border bg-emerald-500 text-white text-xs font-bold" style="clip-path: polygon(50% 0, 100% 25%, 100% 100%, 0 100%, 0 25%);">3</div> Answered</div><div class="flex items-center gap-3"><span class="w-8 h-8 flex items-center justify-center border bg-violet-500 text-white rounded-full text-xs font-bold">4</span> Marked for Review</div></div></li></ol></div>
            <div class="p-6 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 flex flex-col items-center gap-4"><label class="flex items-center gap-3 p-4 bg-blue-50 dark:bg-slate-700 border border-blue-100 dark:border-slate-600 rounded-xl w-full cursor-pointer"><input type="checkbox" id="confirm-check" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500"><span class="text-sm font-medium text-slate-700 dark:text-slate-200">I have read and understood the instructions.</span></label><button id="start-btn" disabled onclick="startTest()" class="w-full sm:w-auto px-12 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg disabled:opacity-50">I am ready to begin</button></div>
        </div>
    </div>

    <!-- MAIN UI -->
    <header class="h-16 bg-gradient-to-r from-slate-900 to-slate-800 dark:from-black dark:to-slate-900 text-white flex items-center justify-between px-6 shadow-md z-20">
        <div class="flex items-center gap-3"><div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center font-bold text-lg">J</div><h1 class="font-bold text-lg hidden sm:block">JEE (Advanced) Mock</h1></div>
        <div class="flex items-center gap-4">
            <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-white/10"><svg id="sun-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><svg id="moon-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></button>
            <div class="bg-slate-700/50 dark:bg-slate-800 px-4 py-2 rounded-lg border border-slate-600 flex items-center gap-2"><span class="text-xs text-slate-400 uppercase font-semibold">Time Left</span><span id="timer" class="font-mono text-xl font-bold text-emerald-400 w-20 text-center">180:00</span></div>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        <main class="flex-1 flex flex-col bg-slate-50 dark:bg-slate-900 relative z-0">
            <div class="bg-slate-800 dark:bg-slate-950 text-slate-300 flex px-4 pt-4 gap-1 select-none" id="subject-tabs">
                <button class="tab-btn px-6 py-2.5 font-medium text-sm active" onclick="switchSubject('Physics')">Physics</button>
                <button class="tab-btn px-6 py-2.5 font-medium text-sm" onclick="switchSubject('Chemistry')">Chemistry</button>
                <button class="tab-btn px-6 py-2.5 font-medium text-sm" onclick="switchSubject('Mathematics')">Mathematics</button>
            </div>
            <div class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-3 flex justify-between items-center shadow-sm z-10">
                <h2 class="font-bold text-slate-800 dark:text-white text-lg" id="current-subject-display">Physics</h2>
                <div class="bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-sm font-bold border border-blue-100 dark:border-blue-800">Question No. <span id="q-num-display">1</span></div>
            </div>
            <div class="flex-1 overflow-y-auto p-6 md:p-8 custom-scrollbar">
                <div class="max-w-full mx-auto bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 min-h-[400px]">
                    <div class="flex justify-between border-b border-slate-100 dark:border-slate-700 pb-4 mb-6"><span class="text-xs font-bold tracking-wider text-slate-400 uppercase" id="q-type-display">Question Type</span><div class="flex items-center gap-3"><span class="px-2 py-1 bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-400 rounded text-xs font-bold">+4 Correct</span><span class="px-2 py-1 bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-400 rounded text-xs font-bold">-1 Wrong</span></div></div>
                    <div id="question-text" class="text-lg text-slate-800 dark:text-slate-100 font-medium leading-relaxed mb-8 select-text"></div>
                    <!-- Image Container with Fallback/Debug Info -->
                    <div id="q-image-container" class="mb-6 hidden flex flex-col items-center">
                        <img id="q-image" src="" class="max-w-full h-auto rounded border border-gray-300 dark:border-gray-600 shadow-sm" alt="Question Diagram">
                        <p id="q-image-debug" class="text-xs text-red-500 mt-2 hidden">Image not found. Check if 'presetups' folder exists.</p>
                    </div>
                    <div id="options-container" class="space-y-3"></div>
                </div>
            </div>
            <div class="bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 p-4 flex flex-wrap items-center justify-between gap-4 shadow-sm z-20">
                <div class="flex gap-3"><button onclick="handleNavigation('prev')" class="px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-600 dark:text-slate-300 font-semibold hover:bg-slate-50 dark:hover:bg-slate-700">&larr; Back</button><button onclick="handleClear()" class="px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 text-slate-600 dark:text-slate-300 font-semibold hover:bg-red-50 dark:hover:bg-red-900/20">Clear</button></div>
                <div class="flex gap-3"><button onclick="handleSaveAndMarkReview()" class="px-5 py-2 rounded-lg bg-violet-600 hover:bg-violet-700 text-white font-semibold shadow-md">Mark Review & Next</button><button onclick="handleSaveAndNext()" class="px-6 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-semibold shadow-md">Save & Next</button></div>
            </div>
        </main>
        <aside class="w-80 bg-white dark:bg-slate-800 border-l border-slate-200 dark:border-slate-700 flex flex-col shadow-xl z-10 hidden lg:flex">
            <div class="p-4 bg-slate-50 dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex items-center gap-4"><div class="w-12 h-12 bg-slate-200 dark:bg-slate-700 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-600 shadow-sm overflow-hidden"><img id="profile-image" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Profile" class="w-full h-full object-cover"></div><div><div class="font-bold text-slate-800 dark:text-white" id="profile-name">Guest User</div><div class="text-xs text-slate-500 dark:text-slate-400 font-medium bg-slate-200 dark:bg-slate-700 px-2 py-0.5 rounded-full inline-block mt-0.5" id="profile-id-display">ID: 123456</div></div></div>
            <div class="bg-slate-50 dark:bg-slate-800 p-4 border-b border-slate-200 dark:border-slate-700 text-[11px] grid grid-cols-2 gap-2 text-slate-600 dark:text-slate-300"><div class="flex items-center gap-1.5"><div class="w-3 h-3 bg-white border border-slate-300 dark:bg-slate-700"></div> Not Visited</div><div class="flex items-center gap-1.5"><div class="w-3 h-3 bg-red-500 rounded-[3px] rounded-bl-[8px]"></div> Not Answered</div><div class="flex items-center gap-1.5"><div class="w-3 h-3 bg-emerald-500 rounded-[3px] rounded-tl-[8px]"></div> Answered</div><div class="flex items-center gap-1.5"><div class="w-3 h-3 bg-violet-500 rounded-full"></div> Review</div></div>
            <div class="p-3 bg-blue-50/50 dark:bg-slate-800 text-blue-800 dark:text-blue-300 text-xs font-bold uppercase text-center border-b border-blue-100 dark:border-slate-700">Question Palette</div>
            <div class="flex-1 overflow-y-auto p-4 custom-scrollbar bg-slate-50/30 dark:bg-slate-900/30"><div class="flex flex-wrap gap-2 justify-center content-start" id="palette-grid"></div></div>
            <div class="p-4 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700"><button class="w-full py-3 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-bold shadow-lg uppercase tracking-wide">Submit Test</button></div>
        </aside>
    </div>

    <script>
        function toggleDarkMode() {
            const html = document.documentElement;
            const sun = document.getElementById('sun-icon');
            const moon = document.getElementById('moon-icon');
            html.classList.toggle('dark');
            if (html.classList.contains('dark')) {
                sun.classList.remove('hidden'); moon.classList.add('hidden');
            } else {
                sun.classList.add('hidden'); moon.classList.remove('hidden');
            }
        }

        const VALID_USERS = [
            // AVATARS AS JPG
            { id: 'itzgoku07', pass: 'TheRSN13', name: 'Rishab Singh', image: 'presetups/itachi.jpg' },
            { id: 'soulreaper', pass: 'saltyballs', name: 'Atharva Sharma', image: 'presetups/monkey.jpg' }
        ];

        const loginOverlay = document.getElementById('login-overlay');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const startOverlay = document.getElementById('start-overlay');
        const profileName = document.getElementById('profile-name');
        const profileIdDisplay = document.getElementById('profile-id-display');
        const profileImage = document.getElementById('profile-image');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const inputId = document.getElementById('login-id').value.trim().toLowerCase();
            const inputPass = document.getElementById('login-pass').value;
            const user = VALID_USERS.find(u => u.id === inputId && u.pass === inputPass);

            if (user) {
                loginError.classList.add('hidden');
                loginOverlay.style.display = 'none';
                startOverlay.classList.remove('hidden'); startOverlay.style.display = 'flex';
                profileName.textContent = user.name;
                profileIdDisplay.textContent = `ID: ${inputId}`;
                profileImage.src = user.image;
                profileImage.onerror = function() { console.warn("Avatar missing"); this.src = "https://cdn-icons-png.flaticon.com/512/149/149071.png"; };
            } else {
                loginError.classList.remove('hidden');
            }
        });

        // --- REAL PHYSICS DATA: DIAGRAMS AS PNG ---
        const physicsQuestions = [
            {
                id: 0, subject: 'Physics', qNum: 1,
                text: "A room air conditioner is modelled as a heat engine run in reverse. An amount of heat $Q_{in}$ is absorbed from the room at a temperature $T_L$ by the cooling coils which contains a working gas; this gas is compressed adiabatically to a temperature $T_H$; then the gas is compressed isothermally in a coil outside of the house, giving off an amount of heat $Q_{out}$; the gas expands adiabatically back to a temperature $T_L$ and finally expanded isothermally to original state and the cycle is repeated. An amount of energy W is input into the system in every cycle through an electric pump. This model describes the air conditioner with the best possible efficiency. The outside air temperature is $T_H$ and the inside air temperature is $T_L$. The air conditioner unit consumes electric power P. Assume that the air is dry sufficiently so that no condensation of water occurs in the cooling coils of the air conditioner. Which of the following may be the rate at which heat is removed from the room?",
                // UPDATED: Now looking for .png
                image: 'presetups/extracted_2.png', 
                options: ["$\\frac{P}{2}(\\frac{T_L}{T_H - T_L})$", "$\\frac{3P}{4}(\\frac{T_L}{T_H - T_L})$", "$\\frac{T_L}{T_H - T_L}$", "$\\frac{3P}{2}(\\frac{T_L}{T_H - T_L})$"],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 1, subject: 'Physics', qNum: 2,
                text: "A conducting medium is shaped in a form of a quarter of an annulus of radii b and a ($b > a$) and thickness t. Specific resistance of the medium is $\\rho$. The correct option(s) is/are:",
                image: 'presetups/extracted_3.png',
                options: ["Resistance between faces LMNO and PQRS is $\\frac{2\\rho}{\\pi t} \\ln \\frac{b}{a}$", "Resistance between faces LMRS and ONQP is $\\frac{\\pi \\rho}{2t \\ln (b/a)}$", "Resistance between faces MRQN and LSPO is $\\frac{4t\\rho}{b^2 - a^2}$", "Between faces LMNO & PQRS and LMRS & ONQP, resistance is same."],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 2, subject: 'Physics', qNum: 3,
                text: "Two resistors, one inductor and a capacitor are connected in a circuit with a battery and switch as shown in figure. The charge on capacitor and current in inductor is zero at $t=0$. Now switch is closed at $t=0$, then choose the correct option(s).",
                image: 'presetups/extracted_4.png',
                options: ["The ratio of maximum current in the branch of inductor to the branch of capacitor is 200.", "At $t = \\frac{\\ln 2}{8}$, the current in the branch of capacitor is 200 times the current in the branch of inductor.", "At $t = \\frac{1}{8} \\ln(5/4)$, the potential drop across inductor is 4 times the potential drop across capacitor.", "The potential drop across inductor is maximum at $t=0$."],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 3, subject: 'Physics', qNum: 4,
                text: "A small disc of mass m is released on a parabolic curve in a vertical plane such that gravity acts along negative y-axis. The equation of parabolic curve is $x^2 = \\frac{2a}{\\sqrt{3}}y$ where 'a' is a positive constant. Frictional force between disc and curve are sufficient for pure rolling. When disc is reached at $x=a$ then choose the correct option(s).",
                image: 'presetups/extracted_5.png',
                options: ["acceleration of disc along the trajectory is $\\sqrt{3}g$.", "acceleration of disc along the trajectory is $g/\\sqrt{3}$.", "frictional force between disc and curve is $\\frac{mg}{2\\sqrt{3}}$.", "frictional force between disc and curve is $\\frac{mg}{\\sqrt{3}}$."],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 4, subject: 'Physics', qNum: 5,
                text: "An object O is kept infront of a converging lens of focal length 30cm behind which there is a plane mirror at 15cm from the lens.",
                image: 'presetups/extracted_6.png',
                options: ["the final image is formed at 60cm from the lens towards right of it", "the final image is at 60cm from lens towards left of it", "the final image is real", "the final image is virtual"],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 5, subject: 'Physics', qNum: 6,
                text: "A light string is wrapped on a cylindrical shell and a fraction of length of string is unwrapped. A particle of mass 2M is attached on another end of string as shown. The system is kept in a vertical plane and cylinder can freely rotate about the axis of cylinder. Particle is released as shown in figure. Assuming there is no slipping between cylinder and string. Choose the correct option(s).",
                image: 'presetups/extracted_7.png',
                options: ["The angular velocity of cylinder just after string taut is $\\frac{8}{3}\\sqrt{\\frac{g}{R}}$", "The angular velocity of cylinder just after string taut is $\\frac{16}{3}\\sqrt{\\frac{g}{R}}$", "Velocity of particle just after string taut is $\\frac{8}{3}\\sqrt{gR}$", "Velocity of particle just after string taut is $\\frac{16}{3}\\sqrt{gR}$"],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 6, subject: 'Physics', qNum: 7,
                text: "A rod of length 2L and cross section area $A_0$ is kept in a liquid of density $\\rho$ and pivoted at point O in a vertical plane. The rod makes angle $30^\\circ$ with the vertical. The mass density of rod is linearly increases from O on both side as given by equation $\\lambda = \\lambda_0(1 + x/L)$ where $\\lambda_0$ is constant and x is distance from point O on either side. Rod is held in vertical plane by applying a force at end A in horizontal direction. Then",
                image: 'presetups/extracted_8.png',
                options: ["Centre of mass of rod OA is at a distance $4L/9$ from point A", "Mass of rod AB is $3\\lambda_0 L / 2$", "Applied force at end A is $\\frac{17}{162\\sqrt{3}} L A_0 \\rho g$", "Buoyant force will act at the centre of mass of rod inside the liquid"],
                status: 'not-visited', selectedOption: null, type: 'MCQ'
            },
            {
                id: 7, subject: 'Physics', qNum: 8,
                text: "Matching: Which of the following is correct regarding minimum path difference? (See YDSE Table in Paper)",
                image: null, 
                options: ["(II) (i) (S)", "(I) (ii) (P)", "(II) (iii) (Q)", "(III) (i) (R)"],
                status: 'not-visited', selectedOption: null, type: 'Matching'
            },
            {
                id: 8, subject: 'Physics', qNum: 9,
                text: "Matching: Which of the following is correct regarding maximum intensity?",
                image: null,
                options: ["(IV) (iii) (Q)", "(I) (ii) (Q)", "(I) (ii) (P)", "(III) (i) (R)"],
                status: 'not-visited', selectedOption: null, type: 'Matching'
            },
            {
                id: 9, subject: 'Physics', qNum: 10,
                text: "Matching: Which of the following is correct regarding minimum intensity?",
                image: null,
                options: ["(II) (i) (S)", "(III) (iv) (R)", "(I) (ii) (R)", "(II) (iii) (R)"],
                status: 'not-visited', selectedOption: null, type: 'Matching'
            },
            {
                id: 10, subject: 'Physics', qNum: 11,
                text: "Matching: Mark the correct statement regarding Rolling Objects (See Table in Paper).",
                image: 'presetups/extracted_9.png', 
                options: ["(I) (i) (P)", "(II) (ii) (Q)", "(III) (ii) (R)", "(IV) (iii) (S)"],
                status: 'not-visited', selectedOption: null, type: 'Matching'
            },
            {
                id: 11, subject: 'Physics', qNum: 12,
                text: "Matching: Mark the incorrect statement.",
                image: null,
                options: ["(I) (ii) (Q)", "(II) (i) (P)", "(III) (iv) (R)", "(IV) (iii) (S)"],
                status: 'not-visited', selectedOption: null, type: 'Matching'
            },
            {
                id: 12, subject: 'Physics', qNum: 13,
                text: "Matching: From the given combination, the kinetic energy for time t will be maximum.",
                image: null,
                options: ["(I) (ii) (Q)", "(II) (iv) (R)", "(III) (iii) (P)", "(IV) (i) (S)"],
                status: 'not-visited', selectedOption: null, type: 'Matching'
            },
            {
                id: 13, subject: 'Physics', qNum: 14,
                text: "Integer: A particle having specific charge $\\sigma$ is projected in xy plane with a speed v. There exists a uniform magnetic field in z-direction having a fixed magnitude $B_0$. The field is made to reverse its direction after every interval of $2\\pi/(\\sigma B_0)$. Calculate the maximum separation (in m) between two positions of the particle during its course of motion. (given $v/(\\sigma B_0) = 2$ meter)",
                image: 'presetups/extracted_10.png',
                options: ["Enter Integer Value"],
                status: 'not-visited', selectedOption: null, type: 'Integer'
            },
            {
                id: 14, subject: 'Physics', qNum: 15,
                text: "Integer: A shell of radius 1m is coated with a thin layer of active material. It's initial charge is zero and initial number of active atoms is $4/3 \\times 10^{12}$. If half life of decay is 1 hr and all the electron are emitted with an energy of 1.44 keV, find the time (in hr.) after which charge on the sphere becomes constant.",
                image: null,
                options: ["Enter Integer Value"],
                status: 'not-visited', selectedOption: null, type: 'Integer'
            },
            {
                id: 15, subject: 'Physics', qNum: 16,
                text: "Integer: Half portion of a spherical capacitor is filled with a dielectric of dielectric constant k=2 and conductivity $\\sigma$. The charge given to spherical capacitor is $Q_0$. Due to the conductivity of dielectric charge leaks. The time constant for the discharge circuit is $n\\epsilon_0/\\sigma$. Find the value of n.",
                image: 'presetups/extracted_11.png', 
                options: ["Enter Integer Value"],
                status: 'not-visited', selectedOption: null, type: 'Integer'
            },
            {
                id: 16, subject: 'Physics', qNum: 17,
                text: "Integer: Figure shows a soap film formed between two square figures made of a uniform wire. The bigger square is held while keeping it in a horizontal plane and the smaller square is slowly allowed to drop vertically. It reaches an equilibrium state after dropping a height h. Given that $h = \\frac{n\\lambda ga}{2\\sqrt{4T^2 - \\lambda^2 g^2}}$, find the integer value n.",
                image: 'presetups/extracted_12.png', 
                options: ["Enter Integer Value"],
                status: 'not-visited', selectedOption: null, type: 'Integer'
            },
            {
                id: 17, subject: 'Physics', qNum: 18,
                text: "Integer: A pipe 20 cm long is closed at one end. Which harmonic mode of the pipe will be resonantly exited by a source of 1237.5 Hz. Sound velocity in air 330 m/s.",
                image: null,
                options: ["Enter Integer Value"],
                status: 'not-visited', selectedOption: null, type: 'Integer'
            }
        ];

        // --- FILLER DATA FOR OTHER SUBJECTS (To prevent errors) ---
        const filler = (subj, start, count) => Array.from({length: count}, (_, i) => ({
            id: start + i, subject: subj, qNum: i + 1,
            text: `[${subj} Q${i+1}] Placeholder question. Only Physics is currently populated from the PDF.`,
            image: null, options: ["Option A", "Option B", "Option C", "Option D"],
            status: 'not-visited', selectedOption: null, type: 'MCQ'
        }));

        const questions = [
            ...physicsQuestions,
            ...filler('Chemistry', 18, 18),
            ...filler('Mathematics', 36, 18)
        ];

        let currentQIndex = 0;
        let currentSubject = 'Physics';

        // --- DOM Elements ---
        const qNumDisplay = document.getElementById('q-num-display');
        const currentSubjectDisplay = document.getElementById('current-subject-display');
        const qTypeDisplay = document.getElementById('q-type-display');
        const qText = document.getElementById('question-text');
        const qImage = document.getElementById('q-image');
        const qImageContainer = document.getElementById('q-image-container');
        const qImageDebug = document.getElementById('q-image-debug');
        const optionsContainer = document.getElementById('options-container');
        const paletteGrid = document.getElementById('palette-grid');
        const subjectTabs = document.getElementById('subject-tabs');

        function init() {
            renderPalette();
            loadQuestion(0);
        }

        const startBtn = document.getElementById('start-btn');
        const confirmCheck = document.getElementById('confirm-check');
        confirmCheck.addEventListener('change', (e) => { startBtn.disabled = !e.target.checked; });

        function startTest() {
            document.getElementById('start-overlay').style.display = 'none';
            try { if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen().catch(err => {}); } catch (e) {}
            startTimer();
        }

        function switchSubject(newSubject) {
            currentSubject = newSubject;
            const firstQ = questions.find(q => q.subject === newSubject);
            if (firstQ) loadQuestion(firstQ.id);
        }

        function updateTabs() {
            Array.from(subjectTabs.children).forEach(btn => {
                if (btn.innerText === currentSubject) {
                    btn.classList.add('active', 'text-slate-800', 'bg-white'); btn.classList.remove('text-slate-300');
                } else {
                    btn.classList.remove('active', 'text-slate-800', 'bg-white'); btn.classList.add('text-slate-300');
                }
            });
        }

        function renderPalette() {
            paletteGrid.innerHTML = '';
            const subjectQuestions = questions.filter(q => q.subject === currentSubject);
            subjectQuestions.forEach((q) => {
                const btn = document.createElement('div');
                btn.className = `p-btn st-${q.status} ${q.id === currentQIndex ? 'active-q' : ''}`;
                btn.innerText = q.qNum;
                btn.onclick = () => loadQuestion(q.id);
                paletteGrid.appendChild(btn);
            });
        }

        function loadQuestion(index) {
            if (questions[currentQIndex].status === 'not-visited') questions[currentQIndex].status = 'not-answered';
            currentQIndex = index;
            const q = questions[currentQIndex];
            if (q.subject !== currentSubject) currentSubject = q.subject;
            if (q.status === 'not-visited') q.status = 'not-answered';

            updateTabs();
            renderPalette();
            
            qNumDisplay.innerText = q.qNum;
            currentSubjectDisplay.innerText = q.subject;
            qTypeDisplay.innerText = q.type || 'MCQ';
            qText.innerHTML = q.text; 

            // Handle Image
            if (q.image) {
                qImage.src = q.image;
                qImageContainer.classList.remove('hidden');
                qImageDebug.classList.add('hidden'); // Reset debug message
                
                // Show debug message if image fails
                qImage.onerror = () => { 
                    qImageDebug.textContent = `❌ Missing: ${q.image}`;
                    qImageDebug.classList.remove('hidden');
                };
            } else {
                qImageContainer.classList.add('hidden');
            }

            // Handle Options (Radio for MCQ/Matching, Input for Integer)
            optionsContainer.innerHTML = '';
            if (q.type === 'Integer') {
                const input = document.createElement('input');
                input.type = 'number';
                input.className = "w-full p-3 border rounded bg-white dark:bg-slate-700 dark:text-white dark:border-slate-600";
                input.placeholder = "Enter Integer Answer (0-9)";
                input.value = q.selectedOption !== null ? q.selectedOption : '';
                input.oninput = (e) => { q.selectedOption = e.target.value; };
                optionsContainer.appendChild(input);
            } else {
                q.options.forEach((opt, idx) => {
                    const row = document.createElement('label');
                    row.className = 'option-row flex items-start cursor-pointer group p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-700 transition';
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = 'option';
                    radio.className = 'custom-radio flex-shrink-0 mt-1';
                    radio.value = idx;
                    radio.checked = q.selectedOption === idx;
                    radio.onchange = () => { q.selectedOption = idx; };
                    const span = document.createElement('span');
                    span.className = "ml-3 text-slate-700 dark:text-slate-300 font-medium group-hover:text-slate-900 dark:group-hover:text-white";
                    span.innerHTML = opt; 
                    row.appendChild(radio);
                    row.appendChild(span);
                    optionsContainer.appendChild(row);
                });
            }
            
            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([qText, optionsContainer]).catch((err) => console.log(err));
            }
        }

        function handleSaveAndNext() {
            const q = questions[currentQIndex];
            q.status = (q.selectedOption !== null && q.selectedOption !== '') ? 'answered' : 'not-answered';
            moveToNext();
        }

        function handleSaveAndMarkReview() {
            const q = questions[currentQIndex];
            q.status = (q.selectedOption !== null && q.selectedOption !== '') ? 'ans-review' : 'review';
            moveToNext();
        }

        function handleClear() {
            const q = questions[currentQIndex];
            q.selectedOption = null;
            q.status = 'not-answered';
            loadQuestion(currentQIndex); // Re-render to clear input
        }

        function moveToNext() {
            if (currentQIndex < questions.length - 1) loadQuestion(currentQIndex + 1);
            else renderPalette();
        }
        
        function handleNavigation(direction) {
            if (direction === 'prev' && currentQIndex > 0) loadQuestion(currentQIndex - 1);
        }

        function startTimer() {
            let duration = 180 * 60;
            const timerEl = document.getElementById('timer');
            setInterval(() => {
                let m = parseInt(duration / 60, 10);
                let s = parseInt(duration % 60, 10);
                m = m < 10 ? "0" + m : m;
                s = s < 10 ? "0" + s : s;
                timerEl.textContent = m + ":" + s;
                if (--duration < 0) duration = 0;
            }, 1000);
        }

        init();
    </script>
</body>
</html>
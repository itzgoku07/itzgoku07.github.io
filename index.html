<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE CBT Portal - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
    </style>
</head>
<body class="h-screen flex flex-col bg-slate-100 text-slate-800">

    <!-- 1. LOGIN SCREEN -->
    <div id="login-screen" class="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
            <div class="bg-blue-600 p-8 text-center">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl font-bold text-white">J</div>
                <h2 class="text-3xl font-bold text-white tracking-wide">Candidate Login</h2>
                <p class="text-blue-100 text-sm mt-1">JEE (Advanced) CBT Portal</p>
            </div>
            
            <form id="login-form" class="p-8 space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Registration ID</label>
                    <input type="text" id="login-id" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" placeholder="Enter ID" required>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Password</label>
                    <input type="password" id="login-pass" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" placeholder="Enter Password" required>
                </div>

                <div id="login-error" class="hidden text-red-500 text-sm font-medium text-center bg-red-50 p-2 rounded border border-red-100">
                    Invalid Credentials
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- 2. DASHBOARD (Initially Hidden) -->
    <div id="dashboard-screen" class="hidden flex-1 flex flex-col h-full">
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shadow-sm z-10">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-600 rounded-lg text-white flex items-center justify-center font-bold">P</div>
                <h1 class="font-bold text-xl text-slate-800">My Tests</h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <div id="dash-name" class="font-bold text-sm text-slate-800">Guest</div>
                    <div id="dash-id" class="text-xs text-slate-500">ID: --</div>
                </div>
                <img id="dash-avatar" src="" class="w-10 h-10 rounded-full border border-slate-200 object-cover bg-slate-100">
                <button onclick="logout()" class="text-sm text-red-500 hover:bg-red-50 px-3 py-1 rounded font-medium ml-2">Logout</button>
            </div>
        </header>

        <!-- Content -->
        <main class="flex-1 p-8 overflow-y-auto">
            <div class="max-w-5xl mx-auto">
                
                <!-- TODAY'S TEST NOTIFICATION BANNER -->
                <div id="todays-test-banner" class="hidden mb-8 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl shadow-lg p-1 text-white animate-fade-in-up">
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 flex flex-col sm:flex-row items-center justify-between gap-4 border border-white/20">
                        <div class="flex items-center gap-4">
                            <div class="p-3 bg-white rounded-full text-emerald-600 shadow-sm animate-pulse-slow">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg">Test Available for Today!</h3>
                                <p class="text-emerald-50 text-sm" id="todays-test-name">JEE Mock Paper 1</p>
                            </div>
                        </div>
                        <button id="start-today-btn" class="bg-white text-emerald-700 hover:bg-emerald-50 font-bold py-2 px-6 rounded-lg shadow-md transition transform active:scale-95 whitespace-nowrap">
                            Start Now &rarr;
                        </button>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-slate-600">Available Papers</h2>
                    <!-- Added ID and 'hidden' class by default -->
                    <button id="create-test-btn" onclick="openAddModal()" class="hidden flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium shadow-md transition-all active:scale-95">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        Create New Test
                    </button>
                </div>

                <!-- Test Grid -->
                <div id="test-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Cards will be injected here -->
                </div>
                
                <div id="empty-state" class="hidden text-center py-20">
                    <div class="w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-400 text-3xl">?</div>
                    <h3 class="text-slate-500 font-medium">No tests found. Create one to get started!</h3>
                </div>
            </div>
        </main>
    </div>

    <!-- 3. ADD TEST MODAL -->
    <div id="add-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-xl shadow-xl p-6">
            <h3 class="text-xl font-bold text-slate-800 mb-4">Add New Test</h3>
            <form id="add-test-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Test Name</label>
                    <input type="text" id="test-name" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g., 01-12-2025 Paper 1" required>
                    <p class="text-xs text-slate-500 mt-1">Tip: Use format DD-MM-YYYY in name for auto-detection.</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">HTML File Path (Relative)</label>
                    <input type="text" id="test-path" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g., 2021_Paper_1/jee_cbt.html" required>
                    <p class="text-xs text-slate-500 mt-1">Ensure the HTML file and its 'presetups' folder are in the same directory relative to this Home Page.</p>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeAddModal()" class="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg font-medium">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">Add Test</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const VALID_USERS = [
            { id: 'itzgoku07', pass: 'TheRSN13', name: 'Rishab Singh', image: 'presetups/itachi.jpg' },
            { id: 'soulreaper', pass: 'saltyballs', name: 'Atharva Sharma', image: 'presetups/monkey.jpg' }
        ];

        let currentUser = null;
        let tests = JSON.parse(localStorage.getItem('jee_tests') || '[]');

        // --- DOM ELEMENTS ---
        const loginScreen = document.getElementById('login-screen');
        const dashboardScreen = document.getElementById('dashboard-screen');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const testGrid = document.getElementById('test-grid');
        const emptyState = document.getElementById('empty-state');
        const addModal = document.getElementById('add-modal');
        const createTestBtn = document.getElementById('create-test-btn');
        
        // Notification Elements
        const todaysTestBanner = document.getElementById('todays-test-banner');
        const todaysTestName = document.getElementById('todays-test-name');
        const startTodayBtn = document.getElementById('start-today-btn');

        // --- LOGIN LOGIC ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('login-id').value.trim().toLowerCase();
            const pass = document.getElementById('login-pass').value;
            
            const user = VALID_USERS.find(u => u.id === id && u.pass === pass);

            if (user) {
                currentUser = user;
                loginScreen.classList.add('hidden');
                dashboardScreen.classList.remove('hidden');
                updateDashboardUI();
                renderTests();
                checkTodaysTest(); // Check for dates on login
            } else {
                loginError.classList.remove('hidden');
            }
        });

        function logout() {
            location.reload();
        }

        function updateDashboardUI() {
            document.getElementById('dash-name').textContent = currentUser.name;
            document.getElementById('dash-id').textContent = `ID: ${currentUser.id}`;
            const img = document.getElementById('dash-avatar');
            img.src = currentUser.image;
            img.onerror = () => { img.src = "https://cdn-icons-png.flaticon.com/512/149/149071.png"; };

            // --- ADMIN CHECK ---
            if (currentUser.id === 'itzgoku07') {
                createTestBtn.classList.remove('hidden');
            } else {
                createTestBtn.classList.add('hidden');
            }
        }

        // --- TEST MANAGEMENT ---
        function renderTests() {
            testGrid.innerHTML = '';
            if (tests.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');

            tests.forEach((test, index) => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition group relative";
                
                // Show delete button ONLY for admin
                const deleteBtnHtml = (currentUser && currentUser.id === 'itzgoku07') 
                    ? `<button onclick="deleteTest(${index})" class="text-slate-300 hover:text-red-500 transition"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>`
                    : '';

                card.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-lg flex items-center justify-center mb-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        </div>
                        ${deleteBtnHtml}
                    </div>
                    <h3 class="font-bold text-lg text-slate-800 mb-1">${test.name}</h3>
                    <p class="text-xs text-slate-500 font-mono bg-slate-50 p-1 rounded mb-4 truncate">${test.path}</p>
                    <button onclick="launchTest(${index})" class="w-full py-2 bg-slate-800 hover:bg-slate-900 text-white rounded-lg font-medium transition">Start Test &rarr;</button>
                `;
                testGrid.appendChild(card);
            });
        }

        function checkTodaysTest() {
            // 1. Get today's date in DD-MM-YYYY format
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0'); // Jan is 0
            const yyyy = today.getFullYear();
            const dateString = `${dd}-${mm}-${yyyy}`;

            // 2. Find matching test (checks if name INCLUDES the date string)
            // This works for "01-12-2025" or "Test 01-12-2025 Paper 1"
            const matchingTestIndex = tests.findIndex(t => t.name.includes(dateString));

            if (matchingTestIndex !== -1) {
                const test = tests[matchingTestIndex];
                todaysTestName.textContent = test.name;
                todaysTestBanner.classList.remove('hidden');
                
                // Bind Start Button
                startTodayBtn.onclick = () => launchTest(matchingTestIndex);
            } else {
                todaysTestBanner.classList.add('hidden');
            }
        }

        function openAddModal() { addModal.classList.remove('hidden'); }
        function closeAddModal() { addModal.classList.add('hidden'); document.getElementById('add-test-form').reset(); }

        document.getElementById('add-test-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('test-name').value;
            const path = document.getElementById('test-path').value;
            
            tests.push({ name, path });
            localStorage.setItem('jee_tests', JSON.stringify(tests));
            renderTests();
            checkTodaysTest(); // Re-check in case the new test is for today
            closeAddModal();
        });

        function deleteTest(index) {
            if(confirm("Remove this test shortcut?")) {
                tests.splice(index, 1);
                localStorage.setItem('jee_tests', JSON.stringify(tests));
                renderTests();
                checkTodaysTest(); // Re-check if we deleted today's test
            }
        }

        function launchTest(index) {
            const test = tests[index];
            if (!currentUser) return;

            // Construct URL with query parameters for the user session
            const params = new URLSearchParams();
            params.append('user', currentUser.name);
            params.append('id', currentUser.id);
            params.append('img', currentUser.image); // Pass the image path
            
            // Redirect
            window.location.href = `${test.path}?${params.toString()}`;
        }
    </script>
</body>
</html>